<!DOCTYPE html>
<html lang="en">
<head>
                <title>meandering journey</title>
        <meta charset="utf-8" />
        <link href="./theme/css/main.css" type="text/css" rel="stylesheet" />
                <link href="http://meandering.journey.sk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="meandering journey Full Atom Feed" />
                                                <link href="http://meandering.journey.sk/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="meandering journey Categories Atom Feed" />
                                        </head>

<body id="index" class="home">
  <div class="all">
  <div class="extra-info">
  
    <aside>
  <h3>About the blog</h3>
  A platform to practice my written communication skills.
  The range of topics tends to surprise even myself.
</aside>
<aside>
  <h3>About the author</h3>
  My name is Ján Hušták. I live near
  <a href="http://maps.google.com/maps?q=bratislava&z=6">Bratislava</a>.
  I've been developing software professionally since 1998.
  The Java platform has served me well but I don't dwell on it.
</aside>
<aside>
  <h3>Links</h3>
  <a href="http://www.journey.sk">Main site</a>,
  <a href="http://coding.journey.sk">projects page</a>,
  <a href="https://github.com/codingjourney">GitHub</a>.
  Sorry, no social networks. I do read mail sent to
  coding &#97;&#116; journey.sk.
</aside>    
    <aside id="tags">
  <h3>Tags</h3>
          <a href="./tag/motivation.html">motivation</a>
      -     <a href="./tag/htpc.html">HTPC</a>
      -     <a href="./tag/openbsd.html">OpenBSD</a>
      -     <a href="./tag/qt.html">Qt</a>
      -     <a href="./tag/upsheet.html">upsheet</a>
      -     <a href="./tag/python.html">Python</a>
      -     <a href="./tag/kde.html">KDE</a>
      -     <a href="./tag/cloud-computing.html">cloud computing</a>
      -     <a href="./tag/caldav.html">CalDAV</a>
      -     <a href="./tag/howto.html">howto</a>
      -     <a href="./tag/jetty.html">Jetty</a>
      -     <a href="./tag/craftsmanship.html">craftsmanship</a>
      -     <a href="./tag/meta.html">meta</a>
      -     <a href="./tag/music.html">music</a>
      -     <a href="./tag/it-misadventures.html">IT misadventures</a>
      -     <a href="./tag/algorithms.html">algorithms</a>
      -     <a href="./tag/android.html">Android</a>
      -     <a href="./tag/cups.html">CUPS</a>
      -     <a href="./tag/security.html">security</a>
      -     <a href="./tag/html5.html">HTML5</a>
    </aside>
    <aside class="links">
  <h3>Recent articles</h3>
      <a href="./much-more-fun-with-planning-poker.html">Much more fun with Planning poker</a>
      <a href="./the-child-that-grew-too-fast.html">The child that grew too fast</a>
      <a href="./mare-nostrum-at-konzerthaus.html">Mare Nostrum at Konzerthaus</a>
      <a href="./too-much-fun-with-planning-poker.html">Too much fun with Planning poker</a>
      <a href="./long-time-no-blog.html">Long time no blog</a>
      <a href="./what-i-did-last-summer.html">What I did last summer</a>
      <a href="./october-2013-is-here.html">October 2013 is here</a>
      <a href="./october-2013.html">October 2013</a>
    </aside>
      
  </div><!-- /.extra-info -->
  <div class="main-column">
  <header id="banner" class="body">
    <h1><a href=".">meandering<img src="./theme/images/logo.png"/>journey</a></h1>
  </header><!-- /#banner -->
        <section id="content" class="body">
  <header>
    <h3>
      <a href="akai-ewi-usb-and-linux-part-2.html" rel="bookmark"
         title="Permalink to Akai EWI USB and Linux, part 2">Akai EWI USB and Linux, part 2</a></h2>
  
  </header>
  <footer class="post-info">
        Published on <abbr class="published" title="2010-11-19T06:15:00"> Fri 19 November 2010 </abbr> under
        <a href="./tag/music.html">music</a>,        <a href="./tag/it-misadventures.html">IT misadventures</a>      </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><a href="./akai-ewi-usb-and-linux-part-1.html">Part 1</a> of my Akai saga ended with the EWI producing sound, a disappearing symlink and a shocking latency. This was unacceptable.</p>
<p>To get a flavor of how things should work, I did something I hadn't done in months: boot into Windows. I dutifully installed the software from EWI's companion CD and tried a few tones. The software itself was nice, polished and simple enough, except that the latency was pretty much the same as under Linux! Google said one should install a different audio stack, "winaudio" or something, but I had no such inclination.</p>
<p>I pulled out the big guns instead. I installed <a href="http://www.64studio.com/">64studio</a> on a spare partition. It's a specialized multimedia-production Linux with pre-configured <a href="http://jackaudio.org/node/11">JACK</a> low-latency audio server etc. and I was certain that it would help. Except it wouldn't talk to my graphics card. Next up was <a href="http://ubuntustudio.org/">Ubuntu Studio</a> - same purpose, different vendor. It installed beautifully, had tons of pre-installed audio software including JACK and QSynth and... exhibited the same latency problem as my regular aptosid and Windows. It was back to the drawing board.</p>
<p>I knew it wasn't a hardware problem - when I ran fluidsynth in verbose mode it would print MIDI events very swiftly, only the sound was lagging. CPU load was negligible so it wasn't any slowness on my computer's part, either. I tried the only thing I could think of - further tweaking fluidsynth's options, this time on the output (audio) side. Lo and behold, when I chose the legacy OSS output driver the system started reacting like a <a href="http://l.yimg.com/eb/ymv/us/img/hv/photo/movie_pix/dreamworks_skg/over_the_hedge/steve_carell/overthehedge_poster.jpg">caffeine-doped squirrel</a>. Sound was coming out almost before I touched the pads. I had reached the Akai EWI nirvana.</p>
<p>The utterly perplexing aspect of this outcome is that I don't even have true OSS on my system; virtually no-one has these days. OSS on my notebook is just a special legacy emulation mode of ALSA, yet it performs better than ALSA proper. Go figure...</p>
<p>I had basically two options to resolve the disappearing symlink from <em>/dev/snd/midiC1D0</em> to <em>/dev/snd/midiC0D0</em>. I could either automate its creation in a start-up script or I could remove the need for it, i.e. make fluidsynth talk to <em>midiC1D0</em> as it should. The latter was obviously a cleaner solution so I started pursuing it. Tweaking the command line had been useless before, hence I downloaded the source code (<em>apt-get source fluidsynth</em>) and started looking around the error messages I was getting ("Unknown RawMidi" etc.).</p>
<p>It turned out that when fluidsynth documentation says I should specify a MIDI device, it doesn't really mean "a path to a device file" but rather "an ALSA device ID", at least when <em>alsa_raw</em> is specified as the MIDI driver. ALSA device IDs have a special syntax that looks like "hw0,0", with the first number identifying a sound card and the second one determining a feature of that sound card one wants to work with. I tried to formulate a device ID for <em>midiC1D0</em> but couldn't figure it out.</p>
<p>Looking through the code, I noticed that when no MIDI device is explicitly specified fluidsynth deduces an ID from various ALSA settings, mainly the default sound card. It occurred to me that I could set the EWI as the default sound card. I remembered that ALSA reads user-specific configuration from <em>~/.asoundrc</em> and a short trip to Google yielded this incantation: <em>defaults.rawmidi.card 1</em>. Having that line in my <em>.asoundrc</em> finally let fluidsynth talk to the EWI without a symlink hack. This wasn't as exciting as doing away with the latency but I felt satisfied that things were finally set up the way they should be.</p>
<p>In summary, all I had needed from the start was that single line in <em>.asoundrc</em> and a simple <em>fluidsynth -m alsa_raw -a oss TimGM6mb.sf2</em> (I use the soundfonts provided on EWI's companion CD). It took a while to get there but I finally had a straightforward way to play the EWI through my notebook.</p>
<p>Once I knew what to set in fluidsynth I configured QSynth with the same settings to get a nice graphical UI for switching sounds and tweaking the effects (fluidsynth has built-in reverb and chorus). This was really comfortable and I became spoiled after a while. It started bugging me that I had to launch QSynth by hand each time I wanted to play. I knew that the computer should be able to do it automatically when the EWI gets plugged in. It should even be able to exit QSynth when the EWI gets unplugged. I decided to tackle that one as well to make my playing truly comfortable. It's a story for another post, however...</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
  </div><!-- /.main-column -->
  </div><!-- /.all -->
</body>
</html>